Version 4
SHEET 1 1656 856
WIRE -96 -304 -128 -304
WIRE 16 -304 -16 -304
WIRE 368 -304 16 -304
WIRE 656 -304 448 -304
WIRE 400 -192 400 -224
WIRE 208 -96 128 -96
WIRE 400 -96 400 -112
WIRE 400 -96 208 -96
WIRE 400 -80 400 -96
WIRE 208 -16 208 -96
WIRE 352 0 304 0
WIRE 400 80 400 16
WIRE 448 80 400 80
WIRE 576 80 528 80
WIRE 128 112 128 -96
WIRE 16 128 16 -304
WIRE 96 128 16 128
WIRE 400 128 400 80
WIRE 304 144 304 0
WIRE 304 144 160 144
WIRE 352 144 304 144
WIRE -416 160 -464 160
WIRE -384 160 -416 160
WIRE -288 160 -336 160
WIRE -160 160 -208 160
WIRE -144 160 -160 160
WIRE -112 160 -144 160
WIRE -80 160 -112 160
WIRE 32 160 0 160
WIRE 96 160 32 160
WIRE -112 208 -112 160
WIRE 32 208 32 160
WIRE -160 240 -160 160
WIRE 128 240 128 176
WIRE 208 240 208 48
WIRE 208 240 128 240
WIRE 272 240 208 240
WIRE 400 240 400 224
WIRE 400 240 272 240
WIRE 400 272 400 240
WIRE 576 272 576 80
WIRE 624 272 576 272
WIRE 656 272 656 -304
WIRE 656 272 624 272
WIRE 576 288 576 272
WIRE 272 304 272 240
WIRE -112 320 -112 272
WIRE -32 320 -112 320
WIRE 32 320 32 272
WIRE 32 320 -32 320
WIRE -32 352 -32 320
WIRE 400 384 400 352
WIRE 576 384 576 368
WIRE -160 400 -160 320
WIRE 272 400 272 384
WIRE 272 400 -160 400
WIRE 272 480 272 400
WIRE 224 528 176 528
WIRE 272 576 272 544
WIRE 176 640 176 528
WIRE 272 640 272 576
WIRE 272 640 176 640
WIRE 272 672 272 640
FLAG 400 -224 0
FLAG -464 160 0
FLAG 400 384 0
FLAG 576 384 0
FLAG -32 352 0
FLAG 624 272 OUT
IOPIN 624 272 Out
FLAG -144 160 IN
IOPIN -144 160 In
FLAG 272 672 0
FLAG -128 -304 0
SYMBOL res 464 -320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1k
SYMBOL voltage 400 -96 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vss+
SYMATTR Value 12
SYMBOL voltage 400 368 R180
WINDOW 0 -84 79 Left 2
WINDOW 3 -65 52 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vss-
SYMATTR Value 12
SYMBOL res 560 272 R0
SYMATTR InstName RSense
SYMATTR Value 1
SYMBOL cap -128 208 R0
SYMATTR InstName C1
SYMATTR Value 100n
SYMBOL cap 16 208 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMBOL res -192 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1K
SYMBOL res 16 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1K
SYMBOL cap 192 -16 R0
SYMATTR InstName C3
SYMATTR Value 10µ
SYMBOL res -144 336 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 1K
SYMBOL Misc\\signal -320 160 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vinput
SYMATTR Value SINE(2.5 1 1)
SYMBOL res 256 288 R0
SYMATTR InstName Radj
SYMATTR Value 330
SYMBOL pmos 352 224 M180
SYMATTR InstName M1
SYMATTR Value irf4905
SYMATTR Prefix X
SYMBOL nmos 352 -80 R0
SYMATTR InstName M2
SYMATTR Value irfz44n
SYMATTR Prefix X
SYMBOL TL431 272 528 M180
SYMATTR InstName U2
SYMBOL res 544 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName LOAD
SYMATTR Value 10
SYMBOL res 0 -320 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL OpAmps\\opamp2 128 80 R0
SYMATTR InstName U1
SYMATTR Value LM358
TEXT -520 680 Left 2 !.tran 0 10 0 0.01
TEXT -160 -472 Left 2 ;The voltage reading at IN must be equal to the voltage reading at OUT\n \nThis works quite well as long as the RLoad is relatively small (<20 Ohms)
TEXT -520 752 Left 2 !.inc E:\\Devs\\constant-current-drive\\ltspice\\irf4905.spi
TEXT -520 800 Left 2 !.inc E:\\Devs\\constant-current-drive\\ltspice\\irfz44n.spi
TEXT -520 840 Left 2 !.inc E:\\Devs\\constant-current-drive\\ltspice\\lm358.spi
